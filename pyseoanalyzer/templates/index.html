<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEOæ™ºèƒ½åˆ†æåŠ©æ‰‹</title>
    
    <!-- Modern CSS Framework -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="seo_styles.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .alert-critical { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .todo-item { transition: all 0.3s ease; }
        .todo-item:hover { transform: translateX(5px); }
        .metric-card { transition: all 0.3s ease-in-out; }
        .metric-card:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .card-hover {
            transition: all 0.3s ease-in-out;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-success {
            animation: pulseSuccess 0.6s ease-in-out;
        }
        
        @keyframes pulseSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .input-focus {
            transition: all 0.2s ease-in-out;
        }
        
        .input-focus:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-search-plus text-2xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">SEOæ™ºèƒ½åˆ†æåŠ©æ‰‹</h1>
                        <p class="text-sm opacity-90">AIé©±åŠ¨çš„SEOåˆ†æã€é¢„è­¦ä¸ä¼˜åŒ–å»ºè®®ç³»ç»Ÿ</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- URLè¾“å…¥æ¡† -->
                    <div class="flex flex-col sm:flex-row items-stretch sm:items-center space-y-2 sm:space-y-0 sm:space-x-2">
                        <div class="relative flex-1">
                            <input type="url" id="urlInput" placeholder="è¾“å…¥è¦åˆ†æçš„URL (ä¾‹å¦‚: https://example.com)" 
                                   class="input-focus px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 w-full transition-all duration-200">
                            <div id="urlValidation" class="absolute right-3 top-1/2 transform -translate-y-1/2 hidden">
                                <i class="fas fa-check-circle text-green-500"></i>
                            </div>
                            <div id="urlError" class="absolute top-full left-0 mt-1 text-xs text-red-500 hidden"></div>
                        </div>
                        <button id="analyzeBtn" class="bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg flex items-center justify-center space-x-2 transition-all duration-200 w-full sm:w-auto">
                            <i class="fas fa-search" id="analyzeIcon"></i>
                            <span id="analyzeText">åˆ†æ</span>
                        </button>
                    </div>
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                        <button id="refreshBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all w-full sm:w-auto flex items-center justify-center space-x-1">
                            <i class="fas fa-sync-alt"></i>
                            <span>åˆ·æ–°</span>
                        </button>
                        <button id="exportBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg w-full sm:w-auto flex items-center justify-center space-x-1">
                            <i class="fas fa-download"></i>
                            <span>å¯¼å‡º</span>
                        </button>
                    </div>
                </div>
                </div>
            </div>
            
            <!-- ä½¿ç”¨æŒ‡å— -->
            <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0">
                        <i class="fas fa-info-circle text-blue-500 mt-0.5"></i>
                    </div>
                    <div class="flex-1">
                        <h4 class="text-sm font-medium text-blue-900 mb-1">ä½¿ç”¨æŒ‡å—</h4>
                        <ul class="text-xs text-blue-700 space-y-1">
                            <li>â€¢ è¾“å…¥å®Œæ•´çš„URLåœ°å€ï¼ˆåŒ…å« http:// æˆ– https://ï¼‰</li>
                            <li>â€¢ åˆ†æè¿‡ç¨‹éœ€è¦10-30ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…</li>
                            <li>â€¢ å·¥å…·ä¼šæ£€æŸ¥é¡µé¢çš„SEOå…ƒç´ ã€å…³é”®è¯å¯†åº¦å’ŒæŠ€æœ¯é—®é¢˜</li>
                            <li>â€¢ åˆ†æå®Œæˆåå¯æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Šå’Œä¼˜åŒ–å»ºè®®</li>
                        </ul>
                    </div>
                    <button id="hideGuide" class="text-blue-400 hover:text-blue-600 text-xs">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </header>
    
    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md mx-4">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"></div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2" id="loadingTitle">æ­£åœ¨åˆ†æä¸­...</h3>
                <p class="text-sm text-gray-600 mb-4" id="loadingMessage">æ­£åœ¨è·å–é¡µé¢å†…å®¹å¹¶è¿›è¡ŒSEOåˆ†æ</p>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-indigo-600 h-2 rounded-full transition-all duration-300" id="loadingProgress" style="width: 0%"></div>
                </div>
                <p class="text-xs text-gray-500 mt-2" id="loadingStep">æ­¥éª¤ 1/4: è¿æ¥åˆ°ç½‘ç«™</p>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-6 py-8">
        <!-- SEOé¢„è­¦ç³»ç»Ÿ -->
        <div id="seoAlerts" class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
                SEOé¢„è­¦ä¸è­¦å‘Š
            </h2>
            <div id="alertsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-info-circle mr-3 text-lg"></i>
                        <div>
                            <h4 class="font-bold">ç³»ç»Ÿå°±ç»ª</h4>
                            <p class="text-sm">è¯·è¾“å…¥URLå¼€å§‹SEOåˆ†æ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SEOè¯„åˆ†å’Œæ¦‚è§ˆ -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-chart-line text-blue-500 mr-2"></i>
                å…³é”®SEOæŒ‡æ ‡
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 lg:gap-6 fade-in">
                <div class="metric-card card-hover bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">é¡µé¢æ€»æ•°</p>
                            <p class="text-3xl font-bold text-blue-600" id="totalPages">0</p>
                        </div>
                        <i class="fas fa-file-alt text-blue-500 text-2xl"></i>
                    </div>
                </div>
                
                <div class="metric-card bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">å…³é”®è¯æ€»æ•°</p>
                            <p class="text-3xl font-bold text-green-600" id="totalKeywords">0</p>
                        </div>
                        <i class="fas fa-key text-green-500 text-2xl"></i>
                    </div>
                </div>
                
                <div class="metric-card bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">å‘ç°é—®é¢˜</p>
                            <p class="text-3xl font-bold text-red-600" id="totalIssues">0</p>
                        </div>
                        <i class="fas fa-bug text-red-500 text-2xl"></i>
                    </div>
                </div>
                
                <div class="metric-card bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">SEOè¯„åˆ†</p>
                            <p class="text-3xl font-bold text-purple-600" id="seoScore">--</p>
                        </div>
                        <i class="fas fa-star text-purple-500 text-2xl"></i>
                    </div>
                </div>
                
                <div class="metric-card bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">åˆ†ææ—¶é—´</p>
                            <p class="text-3xl font-bold text-indigo-600" id="analysisTime">--</p>
                        </div>
                        <i class="fas fa-clock text-indigo-500 text-2xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- SEOå»ºè®®ç³»ç»Ÿ -->
        <div id="recommendationsSection" class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>
                SEOä¼˜åŒ–å»ºè®®
            </h2>
            <div class="bg-white rounded-lg card-shadow p-6 card-hover fade-in">
                <div id="recommendationsContainer">
                    <p class="text-gray-600">è¯·å…ˆè¿›è¡ŒSEOåˆ†æä»¥è·å–ä¼˜åŒ–å»ºè®®</p>
                </div>
            </div>
        </div>

        <!-- TODO List -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-tasks text-indigo-500 mr-2"></i>
                SEOè¡ŒåŠ¨æ¸…å•
            </h2>
            <div class="bg-white rounded-lg card-shadow p-6 card-hover fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 space-y-2 sm:space-y-0">
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 w-full sm:w-auto">
                        <button id="addTodoBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center space-x-2 w-full sm:w-auto">
                            <i class="fas fa-plus"></i>
                            <span>æ·»åŠ ä»»åŠ¡</span>
                        </button>
                        <button id="clearCompletedBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center space-x-2 w-full sm:w-auto">
                            <i class="fas fa-trash"></i>
                            <span>æ¸…é™¤å·²å®Œæˆ</span>
                        </button>
                        <button id="exportTodoBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center space-x-2 w-full sm:w-auto">
                            <i class="fas fa-file-export"></i>
                            <span>å¯¼å‡ºæ¸…å•</span>
                        </button>
                    </div>
                    <div class="text-sm text-gray-600 w-full sm:w-auto text-center sm:text-right">
                        <span id="todoStats">0 ä¸ªå¾…å®Œæˆä»»åŠ¡</span>
                    </div>
                </div>
                <div id="todoContainer">
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-clipboard-list text-4xl mb-4"></i>
                        <p>è¯·å…ˆè¿›è¡ŒSEOåˆ†æä»¥ç”Ÿæˆä¼˜åŒ–ä»»åŠ¡æ¸…å•</p>
                    </div>
                </div>
                
                <!-- Add Todo Form -->
                <div id="addTodoForm" class="hidden mt-4 p-4 bg-gray-50 rounded-lg">
                    <div class="flex space-x-2">
                        <input type="text" id="todoInput" placeholder="è¾“å…¥SEOä»»åŠ¡..." class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <select id="todoPriority" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="low">ä½</option>
                            <option value="medium" selected>ä¸­</option>
                            <option value="high">é«˜</option>
                        </select>
                        <button id="saveTodoBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-save"></i>
                        </button>
                        <button id="cancelTodoBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Analysis -->
        <div id="pageAnalysisSection" class="mb-8 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-file-alt text-blue-500 mr-2"></i>
                é¡µé¢åˆ†æ
            </h2>
            <div class="bg-white rounded-lg card-shadow overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é¡µé¢</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å­—æ•°ç»Ÿè®¡</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é—®é¢˜</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">çŠ¶æ€</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="pageTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Keyword Analysis -->
        <div id="keywordAnalysisSection" class="mb-8 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-key text-green-500 mr-2"></i>
                å…³é”®è¯åˆ†æ
            </h2>
            <div class="bg-white rounded-lg card-shadow p-6">
                <div class="mb-4">
                    <canvas id="keywordChart" width="400" height="200"></canvas>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" onclick="sortTable(0)">
                                    å…³é”®è¯ <i class="fas fa-sort ml-1"></i>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" onclick="sortTable(1)">
                                    å‡ºç°æ¬¡æ•° <i class="fas fa-sort ml-1"></i>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    å¯†åº¦
                                </th>
                            </tr>
                        </thead>
                        <tbody id="keywordTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Page Details Modal -->
    <div id="pageModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900" id="modalTitle">é¡µé¢è¯¦æƒ…</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div id="modalContent">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SEO Agent JavaScript -->
    <script src="seo_agent.js"></script>
    
    <script>
        // Global data
        let pagesData = [];
        let keywordsData = [];
        let currentAnalysisResult = null;
        let seoAgent;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            seoAgent = new SEOAgent();
            setupEventListeners();
            initializeTodoList();
        });

        function setupEventListeners() {
            // Analyze button
            document.getElementById('analyzeBtn').addEventListener('click', performAnalysis);
            
            // Enter key in URL input
            document.getElementById('urlInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performAnalysis();
                }
            });
            
            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', function() {
                location.reload();
            });
            
            // Export button
            document.getElementById('exportBtn').addEventListener('click', exportResults);
        }

        async function performAnalysis() {
            const url = document.getElementById('urlInput').value.trim();
            if (!url) {
                alert('è¯·è¾“å…¥è¦åˆ†æçš„URL');
                return;
            }
            
            // Show loading
            document.getElementById('loadingIndicator').classList.remove('hidden');
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url: url })
                });
                
                if (!response.ok) {
                    throw new Error('åˆ†æè¯·æ±‚å¤±è´¥');
                }
                
                const result = await response.json();
                currentAnalysisResult = result;
                
                // Update UI with results
                updateAnalysisResults(result);
                
            } catch (error) {
                console.error('Analysis error:', error);
                alert('åˆ†æå¤±è´¥: ' + error.message);
            } finally {
                // Hide loading
                document.getElementById('loadingIndicator').classList.add('hidden');
            }
        }

        function updateAnalysisResults(result) {
            // Update global data
            pagesData = result.analysis?.pages || [];
            keywordsData = result.analysis?.keywords || [];
            
            // Update metrics
            document.getElementById('totalPages').textContent = pagesData.length;
            document.getElementById('totalKeywords').textContent = keywordsData.length;
            document.getElementById('analysisTime').textContent = 'åˆšåˆš';
            
            // Update SEO score from API response
            if (result.seo_score) {
                const score = Math.round(result.seo_score.score);
                document.getElementById('seoScore').textContent = score;
                
                // Update color based on score
                const scoreElement = document.getElementById('seoScore');
                scoreElement.className = scoreElement.className.replace(/text-\w+-600/g, '');
                if (score >= 80) {
                    scoreElement.className += ' text-green-600';
                } else if (score >= 60) {
                    scoreElement.className += ' text-yellow-600';
                } else {
                    scoreElement.className += ' text-red-600';
                }
            }
            
            // Update alerts
            updateAlerts(result.seo_insights);
            
            // Update recommendations
            updateRecommendations(result.seo_insights);
            
            // Update TODO list with optimization tasks
            if (result.seo_insights && result.seo_insights.recommendations) {
                updateTodoList(result.seo_insights.recommendations);
            } else if (result.seo_insights && result.seo_insights.issues) {
                // Convert issues to TODO format
                const todoIssues = result.seo_insights.issues.map(issue => ({
                    title: issue.type || issue.title || 'ä¼˜åŒ–ä»»åŠ¡',
                    priority: issue.severity === 'high' ? 'high' : issue.severity === 'medium' ? 'medium' : 'low',
                    category: 'SEOä¼˜åŒ–',
                    description: issue.description || 'éœ€è¦ä¼˜åŒ–çš„SEOé—®é¢˜',
                    action: issue.suggestion || 'è¯·æŸ¥çœ‹è¯¦ç»†è¯´æ˜å¹¶è¿›è¡Œä¼˜åŒ–',
                    time_estimate: '15-30åˆ†é’Ÿ'
                }));
                updateTodoList(todoIssues);
            }
            
            // Update page analysis table
            updatePageAnalysis();
            
            // Update keyword analysis
            updateKeywordAnalysis();
        }

        function updateAlerts(seoInsights) {
            const container = document.getElementById('alertsContainer');
            container.innerHTML = '';
            
            if (seoInsights && seoInsights.issues) {
                seoInsights.issues.forEach(issue => {
                    const alertElement = createAlertElement({
                        type: issue.severity,
                        title: issue.type,
                        message: issue.description,
                        icon: 'fas fa-exclamation-triangle'
                    });
                    container.appendChild(alertElement);
                });
                
                document.getElementById('totalIssues').textContent = seoInsights.issues.length;
            }
            
            if (container.children.length === 0) {
                container.innerHTML = `
                    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle mr-3 text-lg"></i>
                            <div>
                                <h4 class="font-bold">åˆ†æå®Œæˆ</h4>
                                <p class="text-sm">æœªå‘ç°ä¸¥é‡SEOé—®é¢˜</p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function updateRecommendations(seoInsights) {
            const container = document.getElementById('recommendationsContainer');
            
            // æ£€æŸ¥æ˜¯å¦æœ‰ä¼˜åŒ–å»ºè®®æ•°æ®
            if (currentAnalysisResult && currentAnalysisResult.optimization) {
                const optimization = currentAnalysisResult.optimization;
                
                // åˆ›å»ºç®€åŒ–çš„ä¼˜åŒ–å»ºè®®HTMLç»“æ„
                container.innerHTML = `
                    <div class="space-y-4">
                        <!-- ä¼˜åŒ–æ¦‚è§ˆ -->
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200">
                            <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                                <i class="fas fa-chart-pie text-blue-500 mr-2"></i>
                                ä¼˜åŒ–æ¦‚è§ˆ
                            </h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <div class="text-center">
                                    <div class="text-xl font-bold text-red-600">${optimization.summary.critical_issues}</div>
                                    <div class="text-xs text-gray-600">å…³é”®é—®é¢˜</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xl font-bold text-orange-600">${optimization.summary.high_issues}</div>
                                    <div class="text-xs text-gray-600">é«˜ä¼˜å…ˆçº§</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xl font-bold text-yellow-600">${optimization.summary.medium_issues}</div>
                                    <div class="text-xs text-gray-600">ä¸­ä¼˜å…ˆçº§</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xl font-bold text-blue-600">${optimization.summary.estimated_time}</div>
                                    <div class="text-xs text-gray-600">é¢„ä¼°æ—¶é—´</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- å¿«é€Ÿèƒœåˆ©é¡¹ç›® -->
                        <div class="bg-white border border-green-200 rounded-lg p-4">
                            <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                                <i class="fas fa-star text-green-500 mr-2"></i>
                                å¿«é€Ÿèƒœåˆ© (${optimization.recommendations.quick_wins.length}é¡¹)
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                ${optimization.recommendations.quick_wins.slice(0, 4).map(action => `
                                    <div class="border border-gray-200 rounded-lg p-3 hover:shadow-sm transition-shadow">
                                        <div class="flex items-center mb-2">
                                            <span class="text-sm mr-2">âš¡</span>
                                            <h4 class="font-medium text-gray-900 text-sm">${action.title}</h4>
                                        </div>
                                        <p class="text-xs text-gray-600 mb-2">${action.description}</p>
                                        <div class="text-xs text-gray-500">
                                            <span class="mr-3"><i class="fas fa-clock mr-1"></i>${action.time_estimate}</span>
                                            <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full">${action.category}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            ${optimization.recommendations.quick_wins.length > 4 ? `
                                <button onclick="showAllQuickWins()" class="mt-3 text-sm text-blue-600 hover:text-blue-800">
                                    æŸ¥çœ‹å…¨éƒ¨ ${optimization.recommendations.quick_wins.length} é¡¹å¿«é€Ÿèƒœåˆ© â†’
                                </button>
                            ` : ''}
                        </div>
                        
                        <!-- é‡è¦é¡¹ç›® -->
                        <div class="bg-white border border-orange-200 rounded-lg p-4">
                            <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                                <i class="fas fa-project-diagram text-orange-500 mr-2"></i>
                                é‡è¦é¡¹ç›® (${optimization.recommendations.major_projects.length}é¡¹)
                            </h3>
                            <div class="space-y-2">
                                ${optimization.recommendations.major_projects.slice(0, 3).map(action => `
                                    <div class="border border-gray-200 rounded-lg p-3 hover:shadow-sm transition-shadow">
                                        <div class="flex items-center justify-between">
                                            <div class="flex-1">
                                                <div class="flex items-center mb-1">
                                                    <span class="text-sm mr-2">ğŸ¯</span>
                                                    <h4 class="font-medium text-gray-900 text-sm">${action.title}</h4>
                                                </div>
                                                <p class="text-xs text-gray-600">${action.description}</p>
                                            </div>
                                            <div class="text-xs text-gray-500 text-right">
                                                <div><i class="fas fa-clock mr-1"></i>${action.time_estimate}</div>
                                                <span class="px-2 py-1 bg-orange-100 text-orange-800 rounded-full">${action.category}</span>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            ${optimization.recommendations.major_projects.length > 3 ? `
                                <button onclick="showAllMajorProjects()" class="mt-3 text-sm text-blue-600 hover:text-blue-800">
                                    æŸ¥çœ‹å…¨éƒ¨ ${optimization.recommendations.major_projects.length} é¡¹é‡è¦é¡¹ç›® â†’
                                </button>
                            ` : ''}
                        </div>
                        
                        <!-- ä¼˜å…ˆçº§çŸ©é˜µ -->
                        <div class="bg-white border border-gray-200 rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-th text-purple-500 mr-2"></i>
                                ä¼˜å…ˆçº§çŸ©é˜µ
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                    <h4 class="font-medium text-green-800 mb-2 flex items-center">
                                        <i class="fas fa-star text-green-600 mr-2"></i>
                                        å¿«é€Ÿèƒœåˆ© (${optimization.recommendations.quick_wins.length})
                                    </h4>
                                    <p class="text-sm text-green-700 mb-3">é«˜å½±å“ï¼Œä½å·¥ä½œé‡</p>
                                    <div class="space-y-2">
                                        ${optimization.recommendations.quick_wins.slice(0, 3).map(item => `
                                            <div class="text-sm text-green-800">â€¢ ${item.title}</div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <div class="border border-orange-200 rounded-lg p-4 bg-orange-50">
                                    <h4 class="font-medium text-orange-800 mb-2 flex items-center">
                                        <i class="fas fa-project-diagram text-orange-600 mr-2"></i>
                                        é‡å¤§é¡¹ç›® (${optimization.recommendations.major_projects.length})
                                    </h4>
                                    <p class="text-sm text-orange-700 mb-3">é«˜å½±å“ï¼Œé«˜å·¥ä½œé‡</p>
                                    <div class="space-y-2">
                                        ${optimization.recommendations.major_projects.slice(0, 3).map(item => `
                                            <div class="text-sm text-orange-800">â€¢ ${item.title}</div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // æ›´æ–°TODOåˆ—è¡¨ï¼ˆå»é‡åçš„ä¼˜åŒ–å»ºè®®ï¼‰
                updateTodoList(optimization.issues);
            }
        }
        
        function updateTodoList(issues) {
            if (!issues || issues.length === 0) {
                document.getElementById('todoContainer').innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-clipboard-list text-4xl mb-4"></i>
                        <p>æš‚æ— ä¼˜åŒ–ä»»åŠ¡</p>
                    </div>
                `;
                return;
            }
            
            // å»é‡é€»è¾‘ï¼šåŸºäºæ ‡é¢˜å’Œç±»åˆ«å»é‡
            const uniqueIssues = [];
            const seenKeys = new Set();
            
            issues.forEach(issue => {
                const key = `${issue.title}-${issue.category}`;
                if (!seenKeys.has(key)) {
                    seenKeys.add(key);
                    uniqueIssues.push(issue);
                }
            });
            
            // æ¸…ç©ºç°æœ‰TODOåˆ—è¡¨å¹¶æ·»åŠ æ–°çš„ä¼˜åŒ–ä»»åŠ¡
            todoList = uniqueIssues.map(issue => ({
                id: todoIdCounter++,
                text: issue.title,
                priority: issue.priority,
                category: issue.category,
                description: issue.description,
                action: issue.action,
                timeEstimate: issue.time_estimate,
                completed: false,
                createdAt: new Date().toISOString()
            }));
            
            renderTodoListWithCategories();
        }
        
        // TODO List Management
        let todoList = [];
        let todoIdCounter = 1;
        
        function updateTodoList(issues) {
            if (!issues || issues.length === 0) {
                document.getElementById('todoContainer').innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-clipboard-list text-4xl mb-4"></i>
                        <p>æš‚æ— ä¼˜åŒ–ä»»åŠ¡</p>
                    </div>
                `;
                return;
            }
            
            // å»é‡é€»è¾‘ï¼šåŸºäºæ ‡é¢˜å’Œç±»åˆ«å»é‡
            const uniqueIssues = [];
            const seenKeys = new Set();
            
            issues.forEach(issue => {
                const key = `${issue.title}-${issue.category}`;
                if (!seenKeys.has(key)) {
                    seenKeys.add(key);
                    uniqueIssues.push(issue);
                }
            });
            
            // æ¸…ç©ºç°æœ‰TODOåˆ—è¡¨å¹¶æ·»åŠ æ–°çš„ä¼˜åŒ–ä»»åŠ¡
            todoList = uniqueIssues.map(issue => ({
                id: todoIdCounter++,
                text: issue.title,
                priority: issue.priority,
                category: issue.category,
                description: issue.description,
                action: issue.action,
                timeEstimate: issue.time_estimate,
                completed: false,
                createdAt: new Date().toISOString()
            }));
            
            renderTodoListWithCategories();
        }
        
        // æ›´æ–°TODOåˆ—è¡¨
        updateTodoList(optimization.issues);
        
        if (seoInsights && seoInsights.recommendations && seoInsights.recommendations.length > 0) {
                // å…¼å®¹æ—§æ ¼å¼
                const list = document.createElement('ul');
                list.className = 'space-y-3';
                
                seoInsights.recommendations.forEach(rec => {
                    const li = document.createElement('li');
                    li.className = 'flex items-start space-x-3 p-3 bg-gray-50 rounded-lg';
                    const priorityColor = rec.priority === 'high' ? 'red' : 'yellow';
                    const priorityClasses = `bg-${priorityColor}-100 text-${priorityColor}-800`;
                    li.innerHTML = `
                        <i class="fas fa-lightbulb text-yellow-500 mt-1"></i>
                        <div>
                            <h4 class="font-medium text-gray-900">${rec.recommendation}</h4>
                            <p class="text-sm text-gray-600">${rec.url}</p>
                            <span class="inline-block mt-2 px-2 py-1 text-xs ${priorityClasses} rounded">${rec.priority}</span>
                        </div>
                    `;
                    list.appendChild(li);
                });
                
                container.innerHTML = '';
                container.appendChild(list);
            } else {
                container.innerHTML = '<p class="text-gray-600">è¯·å…ˆè¿›è¡ŒSEOåˆ†æä»¥è·å–ä¼˜åŒ–å»ºè®®</p>';
            }
        

        function updatePageAnalysis() {
            if (pagesData.length === 0) return;
            
            const section = document.getElementById('pageAnalysisSection');
            const tbody = document.getElementById('pageTableBody');
            
            tbody.innerHTML = '';
            
            pagesData.forEach((page, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                
                const warningsCount = page.warnings ? page.warnings.length : 0;
                const statusClass = warningsCount === 0 ? 'green' : warningsCount <= 2 ? 'yellow' : 'red';
                const statusText = warningsCount === 0 ? 'è‰¯å¥½' : warningsCount <= 2 ? 'éœ€è¦å…³æ³¨' : 'ä¸¥é‡';
                const statusIcon = warningsCount === 0 ? 'check' : warningsCount <= 2 ? 'exclamation-triangle' : 'times-circle';
                const statusClasses = `bg-${statusClass}-100 text-${statusClass}-800`;
                const iconClass = `fas fa-${statusIcon}`;
                
                row.innerHTML = `
                    <td class="px-6 py-4">
                        <div>
                            <a href="${page.url}" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium">${page.url}</a>
                            <p class="text-sm text-gray-600 mt-1">${page.title || 'No title'}</p>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">${page.word_count || 0}</td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusClasses}">
                            ${warningsCount} ä¸ªé—®é¢˜
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusClasses}">
                            <i class="${iconClass} mr-1"></i>${statusText}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <button onclick="showPageDetails(${index})" class="text-indigo-600 hover:text-indigo-900 text-sm font-medium">
                            <i class="fas fa-eye mr-1"></i>æŸ¥çœ‹è¯¦æƒ…
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            section.classList.remove('hidden');
        }

        function updateKeywordAnalysis() {
            if (keywordsData.length === 0) return;
            
            const section = document.getElementById('keywordAnalysisSection');
            const tbody = document.getElementById('keywordTableBody');
            
            tbody.innerHTML = '';
            
            keywordsData.slice(0, 20).forEach(keyword => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                
                const maxCount = keywordsData[0].count;
                const percentage = ((keyword.count / maxCount) * 100).toFixed(1);
                
                row.innerHTML = `
                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${keyword.word}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${keyword.count}</td>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                            <span class="text-sm text-gray-600">${percentage}%</span>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Initialize keyword chart
            initializeKeywordChart();
            
            section.classList.remove('hidden');
        }

        function createAlertElement(alert) {
            const div = document.createElement('div');
            const alertClass = alert.type === 'critical' || alert.type === 'high' ? 'alert-critical bg-red-100 border-red-400 text-red-700' : 
                              alert.type === 'warning' || alert.type === 'medium' ? 'bg-yellow-100 border-yellow-400 text-yellow-700' : 
                              'bg-blue-100 border-blue-400 text-blue-700';
            
            div.className = `${alertClass} border px-4 py-3 rounded-lg`;
            div.innerHTML = `
                <div class="flex items-center">
                    <i class="${alert.icon} mr-3 text-lg"></i>
                    <div>
                        <h4 class="font-bold">${alert.title}</h4>
                        <p class="text-sm">${alert.message}</p>
                    </div>
                </div>
            `;
            return div;
        }

        function initializeKeywordChart() {
            if (keywordsData.length === 0) return;
            
            const ctx = document.getElementById('keywordChart').getContext('2d');
            const topKeywords = keywordsData.slice(0, 10);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: topKeywords.map(k => k.word),
                    datasets: [{
                        label: 'Keyword Frequency',
                        data: topKeywords.map(k => k.count),
                        backgroundColor: 'rgba(99, 102, 241, 0.8)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function calculateSEOScore() {
            let score = 100;
            let totalIssues = 0;
            
            pagesData.forEach(page => {
                if (page.warnings) {
                    totalIssues += page.warnings.length;
                }
                if (page.word_count && page.word_count < 300) {
                    score -= 5;
                }
            });
            
            score -= Math.min(totalIssues * 2, 50);
            score = Math.max(score, 0);
            
            document.getElementById('seoScore').textContent = score;
            
            // Update color based on score
            const scoreElement = document.getElementById('seoScore');
            scoreElement.className = scoreElement.className.replace(/text-\w+-600/g, '');
            if (score >= 80) {
                scoreElement.className += ' text-green-600';
            } else if (score >= 60) {
                scoreElement.className += ' text-yellow-600';
            } else {
                scoreElement.className += ' text-red-600';
            }
        }

        function showPageDetails(pageIndex) {
            const page = pagesData[pageIndex];
            const modal = document.getElementById('pageModal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            
            title.textContent = `é¡µé¢è¯¦æƒ…: ${page.url}`;
            
            content.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <h4 class="font-bold text-gray-900">æ ‡é¢˜</h4>
                        <p class="text-gray-700">${page.title || 'æœªæ‰¾åˆ°æ ‡é¢˜'}</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900">æè¿°</h4>
                        <p class="text-gray-700">${page.description || 'æœªæ‰¾åˆ°æè¿°'}</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900">å­—æ•°ç»Ÿè®¡</h4>
                        <p class="text-gray-700">${page.word_count || 0} ä¸ªå­—</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900">é—®é¢˜ (${page.warnings ? page.warnings.length : 0})</h4>
                        ${page.warnings && page.warnings.length > 0 ? 
                            '<ul class="list-disc list-inside text-gray-700 space-y-1">' + 
                            page.warnings.map(warning => `<li>${warning}</li>`).join('') + 
                            '</ul>' : 
                            '<p class="text-green-600">æœªå‘ç°é—®é¢˜ï¼</p>'
                        }
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }
        
        function closeModal() {
            document.getElementById('pageModal').classList.add('hidden');
        }

        function sortTable(columnIndex) {
            const table = document.getElementById('keywordTableBody');
            const rows = Array.from(table.rows);
            
            rows.sort((a, b) => {
                const aVal = a.cells[columnIndex].textContent.trim();
                const bVal = b.cells[columnIndex].textContent.trim();
                
                if (columnIndex === 1) { // Count column
                    return parseInt(bVal) - parseInt(aVal);
                } else { // Keyword column
                    return aVal.localeCompare(bVal);
                }
            });
            
            rows.forEach(row => table.appendChild(row));
        }

        function exportResults() {
            if (!currentAnalysisResult) {
                alert('è¯·å…ˆè¿›è¡ŒSEOåˆ†æ');
                return;
            }
            
            const dataStr = JSON.stringify(currentAnalysisResult, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'seo-analysis-result.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        function renderTodoListWithCategories() {
            const container = document.getElementById('todoContainer');
            
            if (todoList.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-clipboard-list text-4xl mb-4"></i>
                        <p>æš‚æ— å¾…åŠä»»åŠ¡</p>
                    </div>
                `;
                updateTodoStats();
                return;
            }
            
            // æŒ‰ç±»åˆ«åˆ†ç»„
            const categories = {};
            todoList.forEach(todo => {
                if (!categories[todo.category]) {
                    categories[todo.category] = [];
                }
                categories[todo.category].push(todo);
            });
            
            // ç±»åˆ«å›¾æ ‡å’Œé¢œè‰²æ˜ å°„
            const categoryConfig = {
                'å†…å®¹ä¼˜åŒ–': { icon: 'fas fa-edit', color: 'blue' },
                'æŠ€æœ¯SEO': { icon: 'fas fa-cogs', color: 'green' },
                'æ€§èƒ½ä¼˜åŒ–': { icon: 'fas fa-tachometer-alt', color: 'purple' },
                'ç”¨æˆ·ä½“éªŒ': { icon: 'fas fa-users', color: 'orange' },
                'é“¾æ¥å»ºè®¾': { icon: 'fas fa-link', color: 'indigo' },
                'ç§»åŠ¨ä¼˜åŒ–': { icon: 'fas fa-mobile-alt', color: 'pink' },
                'è‡ªå®šä¹‰': { icon: 'fas fa-user-edit', color: 'gray' }
            };
            
            container.innerHTML = '';
            Object.keys(categories).forEach(categoryName => {
                const todos = categories[categoryName];
                const config = categoryConfig[categoryName] || categoryConfig['è‡ªå®šä¹‰'];
                const completedCount = todos.filter(t => t.completed).length;
                
                // åˆ›å»ºç±»åˆ«å®¹å™¨
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'mb-6 border border-gray-200 rounded-lg overflow-hidden';
                
                // åˆ›å»ºç±»åˆ«å¤´éƒ¨
                const headerDiv = document.createElement('div');
                headerDiv.className = `bg-${config.color}-50 border-b border-${config.color}-200 px-4 py-3`;
                headerDiv.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <i class="${config.icon} text-${config.color}-600"></i>
                            <h3 class="font-semibold text-${config.color}-800">${categoryName}</h3>
                            <span class="bg-${config.color}-200 text-${config.color}-800 px-2 py-1 rounded-full text-xs font-medium">
                                ${completedCount}/${todos.length}
                            </span>
                        </div>
                        <button onclick="toggleCategory('${categoryName}')" class="text-${config.color}-600 hover:text-${config.color}-800">
                            <i class="fas fa-chevron-down category-toggle" data-category="${categoryName}"></i>
                        </button>
                    </div>
                `;
                
                // åˆ›å»ºå†…å®¹å®¹å™¨
                const contentDiv = document.createElement('div');
                contentDiv.className = 'category-content';
                contentDiv.setAttribute('data-category', categoryName);
                
                // æŒ‰ä¼˜å…ˆçº§æ’åº
                const sortedTodos = todos.sort((a, b) => {
                    if (a.completed !== b.completed) {
                        return a.completed ? 1 : -1;
                    }
                    const priorityOrder = { 'critical': 0, 'high': 1, 'medium': 2, 'low': 3 };
                    return priorityOrder[a.priority] - priorityOrder[b.priority];
                });
                
                sortedTodos.forEach(todo => {
                    const priorityColors = {
                        'critical': 'bg-red-100 text-red-800 border-red-200',
                        'high': 'bg-orange-100 text-orange-800 border-orange-200',
                        'medium': 'bg-yellow-100 text-yellow-800 border-yellow-200',
                        'low': 'bg-blue-100 text-blue-800 border-blue-200'
                    };
                    
                    const priorityIcons = {
                        'critical': 'ğŸ”¥',
                        'high': 'âš¡',
                        'medium': 'âš ï¸',
                        'low': 'ğŸ“'
                    };
                    
                    const todoDiv = document.createElement('div');
                    const todoClasses = `p-4 border-b border-gray-100 last:border-b-0 ${todo.completed ? 'opacity-60 bg-gray-50' : 'bg-white'} hover:bg-gray-50 transition-all`;
                    const titleClasses = `text-sm font-medium text-gray-900 ${todo.completed ? 'line-through' : ''}`;
                    const priorityClass = priorityColors[todo.priority];
                    todoDiv.className = todoClasses;
                    todoDiv.innerHTML = `
                        <div class="flex items-start space-x-3">
                            <input type="checkbox" ${todo.completed ? 'checked' : ''} 
                                   onchange="toggleTodo(${todo.id})" 
                                   class="mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="${titleClasses}">
                                        ${todo.title}
                                    </h4>
                                    <div class="flex items-center space-x-2">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${priorityClass}">
                                            ${priorityIcons[todo.priority]} ${todo.priority}
                                        </span>
                                        <button onclick="deleteTodo(${todo.id})" class="text-red-500 hover:text-red-700">
                                            <i class="fas fa-trash text-xs"></i>
                                        </button>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-600 mb-2 ${titleClasses.includes('line-through') ? 'line-through' : ''}">
                                    ${todo.description}
                                </p>
                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <span>é¢„ä¼°æ—¶é—´: ${todo.estimatedTime}</span>
                                    <span>åˆ›å»ºæ—¶é—´: ${new Date(todo.createdAt).toLocaleDateString()}</span>
                                </div>
                            </div>
                        </div>
                    `;
                    contentDiv.appendChild(todoDiv);
                });
                
                categoryDiv.appendChild(headerDiv);
                categoryDiv.appendChild(contentDiv);
                container.appendChild(categoryDiv);
            });
            updateTodoStats();
        }
        
        function toggleCategory(categoryName) {
            const content = document.querySelector(`[data-category="${categoryName}"]`);
            const icon = document.querySelector(`[data-category="${categoryName}"]`).previousElementSibling.querySelector('.category-toggle');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.classList.remove('fa-chevron-right');
                icon.classList.add('fa-chevron-down');
            } else {
                content.style.display = 'none';
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-right');
            }
        }
        
        function renderTodoList() {
            // ä¿æŒå‘åå…¼å®¹
            renderTodoListWithCategories();
        }
        
        function renderTodoListOld() {
            const container = document.getElementById('todoContainer');
            
            if (todoList.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-clipboard-list text-4xl mb-4"></i>
                        <p>æš‚æ— å¾…åŠä»»åŠ¡</p>
                    </div>
                `;
                updateTodoStats();
                return;
            }
            
            // æŒ‰ä¼˜å…ˆçº§å’Œå®ŒæˆçŠ¶æ€æ’åº
            const sortedTodos = [...todoList].sort((a, b) => {
                if (a.completed !== b.completed) {
                    return a.completed ? 1 : -1;
                }
                const priorityOrder = { 'critical': 0, 'high': 1, 'medium': 2, 'low': 3 };
                return priorityOrder[a.priority] - priorityOrder[b.priority];
            });
            
            container.innerHTML = sortedTodos.map(todo => {
                const priorityColors = {
                    'critical': 'bg-red-100 text-red-800 border-red-200',
                    'high': 'bg-orange-100 text-orange-800 border-orange-200',
                    'medium': 'bg-yellow-100 text-yellow-800 border-yellow-200',
                    'low': 'bg-blue-100 text-blue-800 border-blue-200'
                };
                
                const priorityIcons = {
                    'critical': 'ğŸ”¥',
                    'high': 'âš¡',
                    'medium': 'âš ï¸',
                    'low': 'ğŸ“'
                };
                
                const todoContainerClasses = `border border-gray-200 rounded-lg p-4 mb-3 ${todo.completed ? 'opacity-60 bg-gray-50' : 'bg-white'} hover:shadow-md transition-all`;
                return `
                    <div class="${todoContainerClasses}">
                        <div class="flex items-start space-x-3">
                            <input type="checkbox" ${todo.completed ? 'checked' : ''} 
                                   onchange="toggleTodo(${todo.id})" 
                                   class="mt-1 h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-lg">${priorityIcons[todo.priority]}</span>
                                        <h4 class="font-medium text-gray-900 ${todo.completed ? 'line-through' : ''}">${todo.text}</h4>
                                        <span class="px-2 py-1 text-xs rounded-full ${priorityColors[todo.priority]}">
                                            ${todo.priority}
                                        </span>
                                    </div>
                                    <button onclick="deleteTodo(${todo.id})" class="text-red-500 hover:text-red-700 text-sm">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                                <p class="text-sm text-gray-600 mb-2">${todo.description}</p>
                                <p class="text-sm font-medium text-blue-600 mb-2">${todo.action}</p>
                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <div class="flex items-center space-x-4">
                                        <span><i class="fas fa-clock mr-1"></i>${todo.timeEstimate}</span>
                                        <span><i class="fas fa-tag mr-1"></i>${todo.category}</span>
                                    </div>
                                    <span>${new Date(todo.createdAt).toLocaleDateString()}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            updateTodoStats();
        }
        
        function toggleTodo(id) {
            const todo = todoList.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                renderTodoList();
                saveTodoList();
            }
        }
        
        function deleteTodo(id) {
            todoList = todoList.filter(t => t.id !== id);
            renderTodoList();
            saveTodoList();
        }
        
        function addCustomTodo() {
            const input = document.getElementById('todoInput');
            const priority = document.getElementById('todoPriority');
            
            if (input.value.trim()) {
                const newTodo = {
                    id: todoIdCounter++,
                    text: input.value.trim(),
                    priority: priority.value,
                    category: 'è‡ªå®šä¹‰',
                    description: 'ç”¨æˆ·è‡ªå®šä¹‰ä»»åŠ¡',
                    action: 'æŒ‰éœ€æ‰§è¡Œ',
                    timeEstimate: 'å¾…è¯„ä¼°',
                    completed: false,
                    createdAt: new Date().toISOString()
                };
                
                todoList.push(newTodo);
                renderTodoList();
                saveTodoList();
                
                input.value = '';
                document.getElementById('addTodoForm').classList.add('hidden');
            }
        }
        
        function clearCompletedTodos() {
            todoList = todoList.filter(t => !t.completed);
            renderTodoList();
            saveTodoList();
        }
        
        function exportTodoList() {
            const exportData = {
                exportDate: new Date().toISOString(),
                todos: todoList,
                summary: {
                    total: todoList.length,
                    completed: todoList.filter(t => t.completed).length,
                    pending: todoList.filter(t => !t.completed).length
                }
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `seo-todo-list-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function updateTodoStats() {
            const total = todoList.length;
            const completed = todoList.filter(t => t.completed).length;
            const pending = total - completed;
            
            document.getElementById('todoStats').textContent = `${pending} ä¸ªå¾…å®Œæˆä»»åŠ¡ / å…± ${total} ä¸ª`;
        }
        
        function saveTodoList() {
            localStorage.setItem('seoTodoList', JSON.stringify(todoList));
            localStorage.setItem('todoIdCounter', todoIdCounter.toString());
        }
        
        function loadTodoList() {
            const saved = localStorage.getItem('seoTodoList');
            const savedCounter = localStorage.getItem('todoIdCounter');
            
            if (saved) {
                todoList = JSON.parse(saved);
            }
            if (savedCounter) {
                todoIdCounter = parseInt(savedCounter);
            }
            
            renderTodoList();
        }
        
        function initializeTodoList() {
            loadTodoList();
            
            // äº‹ä»¶ç›‘å¬å™¨
            document.getElementById('addTodoBtn').addEventListener('click', function() {
                document.getElementById('addTodoForm').classList.toggle('hidden');
            });
            
            document.getElementById('saveTodoBtn').addEventListener('click', addCustomTodo);
            
            document.getElementById('cancelTodoBtn').addEventListener('click', function() {
                document.getElementById('addTodoForm').classList.add('hidden');
                document.getElementById('todoInput').value = '';
            });
            
            document.getElementById('clearCompletedBtn').addEventListener('click', clearCompletedTodos);
            
            document.getElementById('exportTodoBtn').addEventListener('click', exportTodoList);
            
            document.getElementById('todoInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addCustomTodo();
                }
            });
        }
        
        function showImplementationDetails(actionId) {
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ˜¾ç¤ºå®æ–½è¯¦æƒ…çš„é€»è¾‘
            alert('å®æ–½è¯¦æƒ…åŠŸèƒ½å¾…å¼€å‘');
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                document.getElementById('addTodoForm').classList.toggle('hidden');
            }
            if (e.key === 'Escape') {
                document.getElementById('addTodoForm').classList.add('hidden');
                closeModal();
            }
        });
    </script>
</body>
</html>
