<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO智能分析助手</title>
    
    <!-- Modern CSS Framework -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="seo_styles.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .alert-critical { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .todo-item { transition: all 0.3s ease; }
        .todo-item:hover { transform: translateX(5px); }
        .metric-card { transition: all 0.3s ease-in-out; }
        .metric-card:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .card-hover {
            transition: all 0.3s ease-in-out;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-success {
            animation: pulseSuccess 0.6s ease-in-out;
        }
        
        @keyframes pulseSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .input-focus {
            transition: all 0.2s ease-in-out;
        }
        
        .input-focus:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-search-plus text-2xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">SEO智能分析助手</h1>
                        <p class="text-sm opacity-90">AI驱动的SEO分析、预警与优化建议系统</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- URL输入框 -->
                    <div class="flex flex-col sm:flex-row items-stretch sm:items-center space-y-2 sm:space-y-0 sm:space-x-2">
                        <div class="relative flex-1">
                            <input type="url" id="urlInput" placeholder="输入要分析的URL (例如: https://example.com)" 
                                   class="input-focus px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 w-full transition-all duration-200">
                            <div id="urlValidation" class="absolute right-3 top-1/2 transform -translate-y-1/2 hidden">
                                <i class="fas fa-check-circle text-green-500"></i>
                            </div>
                            <div id="urlError" class="absolute top-full left-0 mt-1 text-xs text-red-500 hidden"></div>
                        </div>
                        <button id="analyzeBtn" class="bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg flex items-center justify-center space-x-2 transition-all duration-200 w-full sm:w-auto">
                            <i class="fas fa-search" id="analyzeIcon"></i>
                            <span id="analyzeText">分析</span>
                        </button>
                    </div>
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                        <button id="refreshBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all w-full sm:w-auto flex items-center justify-center space-x-1">
                            <i class="fas fa-sync-alt"></i>
                            <span>刷新</span>
                        </button>
                        <button id="exportBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg w-full sm:w-auto flex items-center justify-center space-x-1">
                            <i class="fas fa-download"></i>
                            <span>导出</span>
                        </button>
                    </div>
                </div>
                </div>
            </div>
            
            <!-- 使用指南 -->
            <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0">
                        <i class="fas fa-info-circle text-blue-500 mt-0.5"></i>
                    </div>
                    <div class="flex-1">
                        <h4 class="text-sm font-medium text-blue-900 mb-1">使用指南</h4>
                        <ul class="text-xs text-blue-700 space-y-1">
                            <li>• 输入完整的URL地址（包含 http:// 或 https://）</li>
                            <li>• 分析过程需要10-30秒，请耐心等待</li>
                            <li>• 工具会检查页面的SEO元素、关键词密度和技术问题</li>
                            <li>• 分析完成后可查看详细报告和优化建议</li>
                        </ul>
                    </div>
                    <button id="hideGuide" class="text-blue-400 hover:text-blue-600 text-xs">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </header>
    
    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md mx-4">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"></div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2" id="loadingTitle">正在分析中...</h3>
                <p class="text-sm text-gray-600 mb-4" id="loadingMessage">正在获取页面内容并进行SEO分析</p>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-indigo-600 h-2 rounded-full transition-all duration-300" id="loadingProgress" style="width: 0%"></div>
                </div>
                <p class="text-xs text-gray-500 mt-2" id="loadingStep">步骤 1/4: 连接到网站</p>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-6 py-8">
        <!-- SEO预警系统 -->
        <div id="seoAlerts" class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
                SEO预警与警告
            </h2>
            <div id="alertsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-info-circle mr-3 text-lg"></i>
                        <div>
                            <h4 class="font-bold">系统就绪</h4>
                            <p class="text-sm">请输入URL开始SEO分析</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SEO评分和概览 -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-chart-line text-blue-500 mr-2"></i>
                关键SEO指标
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 lg:gap-6 fade-in">
                <div class="metric-card card-hover bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">页面总数</p>
                            <p class="text-3xl font-bold text-blue-600" id="totalPages">0</p>
                        </div>
                        <i class="fas fa-file-alt text-blue-500 text-2xl"></i>
                    </div>
                </div>
                
                <div class="metric-card bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">关键词总数</p>
                            <p class="text-3xl font-bold text-green-600" id="totalKeywords">0</p>
                        </div>
                        <i class="fas fa-key text-green-500 text-2xl"></i>
                    </div>
                </div>
                
                <div class="metric-card bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">发现问题</p>
                            <p class="text-3xl font-bold text-red-600" id="totalIssues">0</p>
                        </div>
                        <i class="fas fa-bug text-red-500 text-2xl"></i>
                    </div>
                </div>
                
                <div class="metric-card bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">SEO评分</p>
                            <p class="text-3xl font-bold text-purple-600" id="seoScore">--</p>
                        </div>
                        <i class="fas fa-star text-purple-500 text-2xl"></i>
                    </div>
                </div>
                
                <div class="metric-card bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">分析时间</p>
                            <p class="text-3xl font-bold text-indigo-600" id="analysisTime">--</p>
                        </div>
                        <i class="fas fa-clock text-indigo-500 text-2xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- SEO建议系统 -->
        <div id="recommendationsSection" class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>
                SEO优化建议
            </h2>
            <div class="bg-white rounded-lg card-shadow p-6 card-hover fade-in">
                <div id="recommendationsContainer">
                    <p class="text-gray-600">请先进行SEO分析以获取优化建议</p>
                </div>
            </div>
        </div>

        <!-- TODO List -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-tasks text-indigo-500 mr-2"></i>
                SEO行动清单
            </h2>
            <div class="bg-white rounded-lg card-shadow p-6 card-hover fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 space-y-2 sm:space-y-0">
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 w-full sm:w-auto">
                        <button id="addTodoBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center space-x-2 w-full sm:w-auto">
                            <i class="fas fa-plus"></i>
                            <span>添加任务</span>
                        </button>
                        <button id="clearCompletedBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center space-x-2 w-full sm:w-auto">
                            <i class="fas fa-trash"></i>
                            <span>清除已完成</span>
                        </button>
                        <button id="exportTodoBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center space-x-2 w-full sm:w-auto">
                            <i class="fas fa-file-export"></i>
                            <span>导出清单</span>
                        </button>
                    </div>
                    <div class="text-sm text-gray-600 w-full sm:w-auto text-center sm:text-right">
                        <span id="todoStats">0 个待完成任务</span>
                    </div>
                </div>
                <div id="todoContainer">
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-clipboard-list text-4xl mb-4"></i>
                        <p>请先进行SEO分析以生成优化任务清单</p>
                    </div>
                </div>
                
                <!-- Add Todo Form -->
                <div id="addTodoForm" class="hidden mt-4 p-4 bg-gray-50 rounded-lg">
                    <div class="flex space-x-2">
                        <input type="text" id="todoInput" placeholder="输入SEO任务..." class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <select id="todoPriority" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="low">低</option>
                            <option value="medium" selected>中</option>
                            <option value="high">高</option>
                        </select>
                        <button id="saveTodoBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-save"></i>
                        </button>
                        <button id="cancelTodoBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Analysis -->
        <div id="pageAnalysisSection" class="mb-8 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-file-alt text-blue-500 mr-2"></i>
                页面分析
            </h2>
            <div class="bg-white rounded-lg card-shadow overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">页面</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">字数统计</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">问题</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">状态</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                            </tr>
                        </thead>
                        <tbody id="pageTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Keyword Analysis -->
        <div id="keywordAnalysisSection" class="mb-8 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-key text-green-500 mr-2"></i>
                关键词分析
            </h2>
            <div class="bg-white rounded-lg card-shadow p-6">
                <div class="mb-4">
                    <canvas id="keywordChart" width="400" height="200"></canvas>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" onclick="sortTable(0)">
                                    关键词 <i class="fas fa-sort ml-1"></i>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" onclick="sortTable(1)">
                                    出现次数 <i class="fas fa-sort ml-1"></i>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    密度
                                </th>
                            </tr>
                        </thead>
                        <tbody id="keywordTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Page Details Modal -->
    <div id="pageModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900" id="modalTitle">页面详情</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div id="modalContent">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SEO Agent JavaScript -->
    <script src="seo_agent.js"></script>
    
    <script>
        // Global data
        let pagesData = [];
        let keywordsData = [];
        let currentAnalysisResult = null;
        let seoAgent;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            seoAgent = new SEOAgent();
            setupEventListeners();
            initializeTodoList();
        });

        function setupEventListeners() {
            // Analyze button
            document.getElementById('analyzeBtn').addEventListener('click', performAnalysis);
            
            // Enter key in URL input
            document.getElementById('urlInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performAnalysis();
                }
            });
            
            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', function() {
                location.reload();
            });
            
            // Export button
            document.getElementById('exportBtn').addEventListener('click', exportResults);
        }

        async function performAnalysis() {
            const url = document.getElementById('urlInput').value.trim();
            if (!url) {
                alert('请输入要分析的URL');
                return;
            }
            
            // Show loading
            document.getElementById('loadingIndicator').classList.remove('hidden');
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url: url })
                });
                
                if (!response.ok) {
                    throw new Error('分析请求失败');
                }
                
                const result = await response.json();
                currentAnalysisResult = result;
                
                // Update UI with results
                updateAnalysisResults(result);
                
            } catch (error) {
                console.error('Analysis error:', error);
                alert('分析失败: ' + error.message);
            } finally {
                // Hide loading
                document.getElementById('loadingIndicator').classList.add('hidden');
            }
        }

        function updateAnalysisResults(result) {
            // Update global data
            pagesData = result.analysis?.pages || [];
            keywordsData = result.analysis?.keywords || [];
            
            // Update metrics
            document.getElementById('totalPages').textContent = pagesData.length;
            document.getElementById('totalKeywords').textContent = keywordsData.length;
            document.getElementById('analysisTime').textContent = '刚刚';
            
            // Update alerts
            updateAlerts(result.seo_insights);
            
            // Update recommendations
            updateRecommendations(result.seo_insights);
            
            // Update page analysis table
            updatePageAnalysis();
            
            // Update keyword analysis
            updateKeywordAnalysis();
            
            // Calculate and update SEO score
            calculateSEOScore();
        }

        function updateAlerts(seoInsights) {
            const container = document.getElementById('alertsContainer');
            container.innerHTML = '';
            
            if (seoInsights && seoInsights.issues) {
                seoInsights.issues.forEach(issue => {
                    const alertElement = createAlertElement({
                        type: issue.severity,
                        title: issue.type,
                        message: issue.description,
                        icon: 'fas fa-exclamation-triangle'
                    });
                    container.appendChild(alertElement);
                });
                
                document.getElementById('totalIssues').textContent = seoInsights.issues.length;
            }
            
            if (container.children.length === 0) {
                container.innerHTML = `
                    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle mr-3 text-lg"></i>
                            <div>
                                <h4 class="font-bold">分析完成</h4>
                                <p class="text-sm">未发现严重SEO问题</p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function updateRecommendations(seoInsights) {
            const container = document.getElementById('recommendationsContainer');
            
            // 检查是否有优化建议数据
            if (currentAnalysisResult && currentAnalysisResult.optimization) {
                const optimization = currentAnalysisResult.optimization;
                
                // 创建优化建议的HTML结构
                container.innerHTML = `
                    <div class="space-y-6">
                        <!-- 优化概览 -->
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-200">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-chart-pie text-blue-500 mr-2"></i>
                                优化概览
                            </h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-red-600">${optimization.summary.critical_issues}</div>
                                    <div class="text-sm text-gray-600">关键问题</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-orange-600">${optimization.summary.high_issues}</div>
                                    <div class="text-sm text-gray-600">高优先级</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-yellow-600">${optimization.summary.medium_issues}</div>
                                    <div class="text-sm text-gray-600">中优先级</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-600">${optimization.summary.estimated_time}</div>
                                    <div class="text-sm text-gray-600">预估时间</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 立即行动项 -->
                        <div class="bg-white border border-red-200 rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                                立即行动项
                            </h3>
                            <div id="immediateActions" class="space-y-3">
                                ${optimization.recommendations.immediate_actions.map(action => `
                                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <div class="flex items-center mb-2">
                                                    <span class="text-lg mr-2">${action.priority_icon}</span>
                                                    <h4 class="font-medium text-gray-900">${action.title}</h4>
                                                    <span class="ml-2 px-2 py-1 text-xs rounded-full" style="background-color: ${action.priority_color}20; color: ${action.priority_color}">
                                                        ${action.priority}
                                                    </span>
                                                </div>
                                                <p class="text-sm text-gray-600 mb-2">${action.description}</p>
                                                <p class="text-sm font-medium text-blue-600 mb-3">${action.action}</p>
                                                <div class="text-xs text-gray-500">
                                                    <span class="mr-4"><i class="fas fa-clock mr-1"></i>${action.time_estimate}</span>
                                                    <span><i class="fas fa-tag mr-1"></i>${action.category}</span>
                                                </div>
                                            </div>
                                            <button onclick="showImplementationDetails('${action.id}')" class="ml-4 text-blue-600 hover:text-blue-800 text-sm">
                                                <i class="fas fa-info-circle"></i>
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- 优先级矩阵 -->
                        <div class="bg-white border border-gray-200 rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-th text-purple-500 mr-2"></i>
                                优先级矩阵
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                    <h4 class="font-medium text-green-800 mb-2 flex items-center">
                                        <i class="fas fa-star text-green-600 mr-2"></i>
                                        快速胜利 (${optimization.recommendations.priority_matrix.quick_wins.length})
                                    </h4>
                                    <p class="text-sm text-green-700 mb-3">高影响，低工作量</p>
                                    <div class="space-y-2">
                                        ${optimization.recommendations.priority_matrix.quick_wins.slice(0, 3).map(item => `
                                            <div class="text-sm text-green-800">• ${item.title}</div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <div class="border border-orange-200 rounded-lg p-4 bg-orange-50">
                                    <h4 class="font-medium text-orange-800 mb-2 flex items-center">
                                        <i class="fas fa-project-diagram text-orange-600 mr-2"></i>
                                        重大项目 (${optimization.recommendations.priority_matrix.major_projects.length})
                                    </h4>
                                    <p class="text-sm text-orange-700 mb-3">高影响，高工作量</p>
                                    <div class="space-y-2">
                                        ${optimization.recommendations.priority_matrix.major_projects.slice(0, 3).map(item => `
                                            <div class="text-sm text-orange-800">• ${item.title}</div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // 更新TODO列表
                updateTodoList(optimization.issues);
                
            } else if (seoInsights && seoInsights.recommendations && seoInsights.recommendations.length > 0) {
                // 兼容旧格式
                const list = document.createElement('ul');
                list.className = 'space-y-3';
                
                seoInsights.recommendations.forEach(rec => {
                    const li = document.createElement('li');
                    li.className = 'flex items-start space-x-3 p-3 bg-gray-50 rounded-lg';
                    li.innerHTML = `
                        <i class="fas fa-lightbulb text-yellow-500 mt-1"></i>
                        <div>
                            <h4 class="font-medium text-gray-900">${rec.recommendation}</h4>
                            <p class="text-sm text-gray-600">${rec.url}</p>
                            <span class="inline-block mt-2 px-2 py-1 text-xs bg-${rec.priority === 'high' ? 'red' : 'yellow'}-100 text-${rec.priority === 'high' ? 'red' : 'yellow'}-800 rounded">${rec.priority}</span>
                        </div>
                    `;
                    list.appendChild(li);
                });
                
                container.innerHTML = '';
                container.appendChild(list);
            } else {
                container.innerHTML = '<p class="text-gray-600">请先进行SEO分析以获取优化建议</p>';
            }
        }

        function updatePageAnalysis() {
            if (pagesData.length === 0) return;
            
            const section = document.getElementById('pageAnalysisSection');
            const tbody = document.getElementById('pageTableBody');
            
            tbody.innerHTML = '';
            
            pagesData.forEach((page, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                
                const warningsCount = page.warnings ? page.warnings.length : 0;
                const statusClass = warningsCount === 0 ? 'green' : warningsCount <= 2 ? 'yellow' : 'red';
                const statusText = warningsCount === 0 ? '良好' : warningsCount <= 2 ? '需要关注' : '严重';
                const statusIcon = warningsCount === 0 ? 'check' : warningsCount <= 2 ? 'exclamation-triangle' : 'times-circle';
                
                row.innerHTML = `
                    <td class="px-6 py-4">
                        <div>
                            <a href="${page.url}" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium">${page.url}</a>
                            <p class="text-sm text-gray-600 mt-1">${page.title || 'No title'}</p>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">${page.word_count || 0}</td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${statusClass}-100 text-${statusClass}-800">
                            ${warningsCount} 个问题
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${statusClass}-100 text-${statusClass}-800">
                            <i class="fas fa-${statusIcon} mr-1"></i>${statusText}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <button onclick="showPageDetails(${index})" class="text-indigo-600 hover:text-indigo-900 text-sm font-medium">
                            <i class="fas fa-eye mr-1"></i>查看详情
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            section.classList.remove('hidden');
        }

        function updateKeywordAnalysis() {
            if (keywordsData.length === 0) return;
            
            const section = document.getElementById('keywordAnalysisSection');
            const tbody = document.getElementById('keywordTableBody');
            
            tbody.innerHTML = '';
            
            keywordsData.slice(0, 20).forEach(keyword => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                
                const maxCount = keywordsData[0].count;
                const percentage = ((keyword.count / maxCount) * 100).toFixed(1);
                
                row.innerHTML = `
                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${keyword.word}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${keyword.count}</td>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                            <span class="text-sm text-gray-600">${percentage}%</span>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Initialize keyword chart
            initializeKeywordChart();
            
            section.classList.remove('hidden');
        }

        function createAlertElement(alert) {
            const div = document.createElement('div');
            const alertClass = alert.type === 'critical' || alert.type === 'high' ? 'alert-critical bg-red-100 border-red-400 text-red-700' : 
                              alert.type === 'warning' || alert.type === 'medium' ? 'bg-yellow-100 border-yellow-400 text-yellow-700' : 
                              'bg-blue-100 border-blue-400 text-blue-700';
            
            div.className = `${alertClass} border px-4 py-3 rounded-lg`;
            div.innerHTML = `
                <div class="flex items-center">
                    <i class="${alert.icon} mr-3 text-lg"></i>
                    <div>
                        <h4 class="font-bold">${alert.title}</h4>
                        <p class="text-sm">${alert.message}</p>
                    </div>
                </div>
            `;
            return div;
        }

        function initializeKeywordChart() {
            if (keywordsData.length === 0) return;
            
            const ctx = document.getElementById('keywordChart').getContext('2d');
            const topKeywords = keywordsData.slice(0, 10);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: topKeywords.map(k => k.word),
                    datasets: [{
                        label: 'Keyword Frequency',
                        data: topKeywords.map(k => k.count),
                        backgroundColor: 'rgba(99, 102, 241, 0.8)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function calculateSEOScore() {
            let score = 100;
            let totalIssues = 0;
            
            pagesData.forEach(page => {
                if (page.warnings) {
                    totalIssues += page.warnings.length;
                }
                if (page.word_count && page.word_count < 300) {
                    score -= 5;
                }
            });
            
            score -= Math.min(totalIssues * 2, 50);
            score = Math.max(score, 0);
            
            document.getElementById('seoScore').textContent = score;
            
            // Update color based on score
            const scoreElement = document.getElementById('seoScore');
            scoreElement.className = scoreElement.className.replace(/text-\w+-600/g, '');
            if (score >= 80) {
                scoreElement.className += ' text-green-600';
            } else if (score >= 60) {
                scoreElement.className += ' text-yellow-600';
            } else {
                scoreElement.className += ' text-red-600';
            }
        }

        function showPageDetails(pageIndex) {
            const page = pagesData[pageIndex];
            const modal = document.getElementById('pageModal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            
            title.textContent = `页面详情: ${page.url}`;
            
            content.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <h4 class="font-bold text-gray-900">标题</h4>
                        <p class="text-gray-700">${page.title || '未找到标题'}</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900">描述</h4>
                        <p class="text-gray-700">${page.description || '未找到描述'}</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900">字数统计</h4>
                        <p class="text-gray-700">${page.word_count || 0} 个字</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900">问题 (${page.warnings ? page.warnings.length : 0})</h4>
                        ${page.warnings && page.warnings.length > 0 ? 
                            '<ul class="list-disc list-inside text-gray-700 space-y-1">' + 
                            page.warnings.map(warning => `<li>${warning}</li>`).join('') + 
                            '</ul>' : 
                            '<p class="text-green-600">未发现问题！</p>'
                        }
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }
        
        function closeModal() {
            document.getElementById('pageModal').classList.add('hidden');
        }

        function sortTable(columnIndex) {
            const table = document.getElementById('keywordTableBody');
            const rows = Array.from(table.rows);
            
            rows.sort((a, b) => {
                const aVal = a.cells[columnIndex].textContent.trim();
                const bVal = b.cells[columnIndex].textContent.trim();
                
                if (columnIndex === 1) { // Count column
                    return parseInt(bVal) - parseInt(aVal);
                } else { // Keyword column
                    return aVal.localeCompare(bVal);
                }
            });
            
            rows.forEach(row => table.appendChild(row));
        }

        function exportResults() {
            if (!currentAnalysisResult) {
                alert('请先进行SEO分析');
                return;
            }
            
            const dataStr = JSON.stringify(currentAnalysisResult, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'seo-analysis-result.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        // TODO List Management
        let todoList = [];
        let todoIdCounter = 1;
        
        function updateTodoList(issues) {
            if (!issues || issues.length === 0) {
                document.getElementById('todoContainer').innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-clipboard-list text-4xl mb-4"></i>
                        <p>暂无优化任务</p>
                    </div>
                `;
                return;
            }
            
            // 清空现有TODO列表并添加新的优化任务
            todoList = issues.map(issue => ({
                id: todoIdCounter++,
                text: issue.title,
                priority: issue.priority,
                category: issue.category,
                description: issue.description,
                action: issue.action,
                timeEstimate: issue.time_estimate,
                completed: false,
                createdAt: new Date().toISOString()
            }));
            
            renderTodoList();
        }
        
        function renderTodoList() {
            const container = document.getElementById('todoContainer');
            
            if (todoList.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-clipboard-list text-4xl mb-4"></i>
                        <p>暂无待办任务</p>
                    </div>
                `;
                updateTodoStats();
                return;
            }
            
            // 按优先级和完成状态排序
            const sortedTodos = [...todoList].sort((a, b) => {
                if (a.completed !== b.completed) {
                    return a.completed ? 1 : -1;
                }
                const priorityOrder = { 'critical': 0, 'high': 1, 'medium': 2, 'low': 3 };
                return priorityOrder[a.priority] - priorityOrder[b.priority];
            });
            
            container.innerHTML = sortedTodos.map(todo => {
                const priorityColors = {
                    'critical': 'bg-red-100 text-red-800 border-red-200',
                    'high': 'bg-orange-100 text-orange-800 border-orange-200',
                    'medium': 'bg-yellow-100 text-yellow-800 border-yellow-200',
                    'low': 'bg-blue-100 text-blue-800 border-blue-200'
                };
                
                const priorityIcons = {
                    'critical': '🔥',
                    'high': '⚡',
                    'medium': '⚠️',
                    'low': '📝'
                };
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4 mb-3 ${todo.completed ? 'opacity-60 bg-gray-50' : 'bg-white'} hover:shadow-md transition-all">
                        <div class="flex items-start space-x-3">
                            <input type="checkbox" ${todo.completed ? 'checked' : ''} 
                                   onchange="toggleTodo(${todo.id})" 
                                   class="mt-1 h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-lg">${priorityIcons[todo.priority]}</span>
                                        <h4 class="font-medium text-gray-900 ${todo.completed ? 'line-through' : ''}">${todo.text}</h4>
                                        <span class="px-2 py-1 text-xs rounded-full ${priorityColors[todo.priority]}">
                                            ${todo.priority}
                                        </span>
                                    </div>
                                    <button onclick="deleteTodo(${todo.id})" class="text-red-500 hover:text-red-700 text-sm">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                                <p class="text-sm text-gray-600 mb-2">${todo.description}</p>
                                <p class="text-sm font-medium text-blue-600 mb-2">${todo.action}</p>
                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <div class="flex items-center space-x-4">
                                        <span><i class="fas fa-clock mr-1"></i>${todo.timeEstimate}</span>
                                        <span><i class="fas fa-tag mr-1"></i>${todo.category}</span>
                                    </div>
                                    <span>${new Date(todo.createdAt).toLocaleDateString()}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            updateTodoStats();
        }
        
        function toggleTodo(id) {
            const todo = todoList.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                renderTodoList();
                saveTodoList();
            }
        }
        
        function deleteTodo(id) {
            todoList = todoList.filter(t => t.id !== id);
            renderTodoList();
            saveTodoList();
        }
        
        function addCustomTodo() {
            const input = document.getElementById('todoInput');
            const priority = document.getElementById('todoPriority');
            
            if (input.value.trim()) {
                const newTodo = {
                    id: todoIdCounter++,
                    text: input.value.trim(),
                    priority: priority.value,
                    category: '自定义',
                    description: '用户自定义任务',
                    action: '按需执行',
                    timeEstimate: '待评估',
                    completed: false,
                    createdAt: new Date().toISOString()
                };
                
                todoList.push(newTodo);
                renderTodoList();
                saveTodoList();
                
                input.value = '';
                document.getElementById('addTodoForm').classList.add('hidden');
            }
        }
        
        function clearCompletedTodos() {
            todoList = todoList.filter(t => !t.completed);
            renderTodoList();
            saveTodoList();
        }
        
        function exportTodoList() {
            const exportData = {
                exportDate: new Date().toISOString(),
                todos: todoList,
                summary: {
                    total: todoList.length,
                    completed: todoList.filter(t => t.completed).length,
                    pending: todoList.filter(t => !t.completed).length
                }
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `seo-todo-list-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function updateTodoStats() {
            const total = todoList.length;
            const completed = todoList.filter(t => t.completed).length;
            const pending = total - completed;
            
            document.getElementById('todoStats').textContent = `${pending} 个待完成任务 / 共 ${total} 个`;
        }
        
        function saveTodoList() {
            localStorage.setItem('seoTodoList', JSON.stringify(todoList));
            localStorage.setItem('todoIdCounter', todoIdCounter.toString());
        }
        
        function loadTodoList() {
            const saved = localStorage.getItem('seoTodoList');
            const savedCounter = localStorage.getItem('todoIdCounter');
            
            if (saved) {
                todoList = JSON.parse(saved);
            }
            if (savedCounter) {
                todoIdCounter = parseInt(savedCounter);
            }
            
            renderTodoList();
        }
        
        function initializeTodoList() {
            loadTodoList();
            
            // 事件监听器
            document.getElementById('addTodoBtn').addEventListener('click', function() {
                document.getElementById('addTodoForm').classList.toggle('hidden');
            });
            
            document.getElementById('saveTodoBtn').addEventListener('click', addCustomTodo);
            
            document.getElementById('cancelTodoBtn').addEventListener('click', function() {
                document.getElementById('addTodoForm').classList.add('hidden');
                document.getElementById('todoInput').value = '';
            });
            
            document.getElementById('clearCompletedBtn').addEventListener('click', clearCompletedTodos);
            
            document.getElementById('exportTodoBtn').addEventListener('click', exportTodoList);
            
            document.getElementById('todoInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addCustomTodo();
                }
            });
        }
        
        function showImplementationDetails(actionId) {
            // 这里可以添加显示实施详情的逻辑
            alert('实施详情功能待开发');
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                document.getElementById('addTodoForm').classList.toggle('hidden');
            }
            if (e.key === 'Escape') {
                document.getElementById('addTodoForm').classList.add('hidden');
                closeModal();
            }
        });
    </script>
</body>
</html>